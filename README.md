# ESP32EnvironmentController
An environment (Temperature, humidity, Co2) controller for ESP32

At minimum the controller can work with only 1 sensor. Connecting the relevant sensor will provide that value to the dashboard. For more advanced usage GPIO pins are provisioned to control relays or switching transistors

## Feature list:
* Post live data to MQTT server
* Sensor data retriveable via HTTP
* Control fan speed and dehumidifer state remotely (Can also control other appliances)
* Using a cloud MQTT Broker makes the controller accessible from anywhere you have an internet connection
* Compatibility with Node-red dashboard to display graphs of temperature, humidity, VPD, co2 levels and state of appliances being controlled.
* All data is saved to a file on the Node-red server and graphs can be generated by using the DataPlotter.py script

## Part list:
All parts are needed for full functionality but most are optional
* ESP32 board
* BME280 or BME6 temp and humidity sensor
* SGP30 Co2 sensor
* Breadboard jumper wires
* Neopixel LED (optional for status indicator)
* Resistors and NPN transistors, relays (optional for controlling peripherals)


## Build instructions:
1. Register on MQHive for a cloud MQTT Broker or setup a MQTT broker locally.
2. Download this repo and open in Vscode. You will need the Platformio extension installed.
3. Fill out Crendentials.h with credentials for your wifi network and MQTT broker.
4. Connect your ESP32 to the computer via usb
5. Set the COM port of your ESP32 in `platformio.ini` file and flash the firmware.

Once flashing is complete you should see the Esp32 connect to Wifi and authenticate with your MQTT broker via the serial monitor output.

6. Install Node-red on a computer (or phone or raspberry pi)
7. In Node-red import the dashboard.json (or Mobile.josn on mobile) flow file in this repo.
8. In Node-red configure MQTT broker login details you created in step 2.
9. Connect sensors to the ESP32 (see below), and connect the esp to power either via the pins or USB port (Requires 5v 2A). Unfortunately, most PC usb ports only provide 1A so you will need a usb plug adapter or power supply.


## Sensor connections:
* The BME280 and SGP30 are both I2C devices that require the following pins on the esp32 `3.3v`, `GND`, `pin 21 for SDA` and `pin 22 for SCL`
As both sensors require pins 21 and 22 you may need a splitter cable or breadboard

## Peripheral connections:
This controller firmware can also control other devices!

* An external fan be controlled via a switching transistor and pin 12 (Tested at 12v)
* A dehumidifier can be attached via a switching transistor or relay on pin 13. e.g this can be used with a transistor to press a momentary on/off button, or to control a relay switching the dehumidifier. May not work with all dehumidifiers without modification.
* A Neopixel LED can be connected to 5v and Pin 16 where it will act as a status indicator. This mostly for development and debug purposes.
